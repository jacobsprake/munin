# Munin SCADA Connector Configuration
# Copy to connectors.yaml and edit for your site
#
# Each connector defines a data source and how Munin reads from it.
# See docs/SCADA_INGESTION_GUIDE.md for full documentation.

connectors:
  # --- Water Sector (Environment Agency) ---
  - id: csv_demo
    type: csv_historian
    description: "Demo data from CSV files"
    data_dir: "engine/sample_data"
    enabled: true
    polling_interval: 0  # 0 = one-shot import, not polling
    node_id_mapping: {}  # Use node_id from CSV directly

  - id: ea_flood_api
    type: rest_api
    description: "EA Flood Monitoring API (river levels)"
    base_url: "https://environment.data.gov.uk/flood-monitoring"
    api_key_env: "EA_API_KEY"
    enabled: false  # Enable when API key is configured
    polling_interval: 900  # 15 minutes
    endpoints:
      - path: "/id/stations/{stationId}/readings"
        params:
          _sorted: true
          _limit: 100
        stations:
          - {station_id: "E70401", node_id: "eden_river_level", label: "River Eden at Sheepmount"}
          - {station_id: "E72319", node_id: "petteril_river_level", label: "River Petteril at Botcherby"}

  - id: pi_historian_water
    type: pi_historian
    description: "OSIsoft PI historian for water infrastructure"
    connection_string: "PI_SERVER=pi.water.internal;PI_PORT=5450"
    enabled: false  # Enable when PI server is accessible
    polling_interval: 60
    tags:
      - {pi_tag: "PUMP.FLOW.01", node_id: "pump_station_01", unit: "m3/h"}
      - {pi_tag: "PUMP.FLOW.02", node_id: "pump_station_02", unit: "m3/h"}
      - {pi_tag: "RESERVOIR.LEVEL.ALPHA", node_id: "reservoir_alpha", unit: "m"}
      - {pi_tag: "WTP.PRESSURE.MAIN", node_id: "water_pressure_01", unit: "bar"}

  # --- Power Sector (National Grid ESO) ---
  - id: dnp3_substations
    type: dnp3
    description: "DNP3 connection to power substations"
    connection_string: "TCP:10.0.1.100:20000"
    master_address: 1
    outstation_address: 10
    enabled: false
    polling_interval: 5
    points:
      - {index: 0, type: "analog_input", node_id: "substation_north_01", unit: "Hz", scale: 0.01}
      - {index: 1, type: "analog_input", node_id: "substation_south_01", unit: "Hz", scale: 0.01}
      - {index: 2, type: "analog_input", node_id: "substation_north_01_voltage", unit: "kV", scale: 0.1}

  - id: iec61850_grid
    type: iec61850
    description: "IEC 61850 connection to grid protection relays"
    connection_string: "10.0.3.100:102"
    enabled: false
    polling_interval: 2
    logical_devices:
      - {ld: "PROT", ln: "MMXU1", fc: "MX", attr: "Hz.mag.f", node_id: "grid_frequency"}
      - {ld: "PROT", ln: "MMXU1", fc: "MX", attr: "PhV.phsA.cVal.mag.f", node_id: "voltage_phase_a"}

  # --- Telecom Sector (BT/Openreach) ---
  - id: snmp_towers
    type: snmp
    description: "SNMP monitoring of telecom towers"
    community: "munin_readonly"
    enabled: false
    polling_interval: 300
    targets:
      - {host: "10.0.4.1", oid: "1.3.6.1.2.1.1.3.0", node_id: "tower_carlisle_central", metric: "uptime"}
      - {host: "10.0.4.2", oid: "1.3.6.1.2.1.1.3.0", node_id: "tower_penrith", metric: "uptime"}

  # --- Building Management (Hospital) ---
  - id: bacnet_hospital
    type: bacnet
    description: "BACnet connection to hospital building management"
    connection_string: "10.0.5.1:47808"
    enabled: false
    polling_interval: 30
    objects:
      - {type: "analog-input", instance: 1, node_id: "hospital_cumberland_power", unit: "kW"}
      - {type: "analog-input", instance: 2, node_id: "hospital_cumberland_temp", unit: "degC"}
      - {type: "binary-input", instance: 10, node_id: "hospital_cumberland_backup_gen", unit: "on/off"}

  # --- Modbus (Generic) ---
  - id: modbus_pumps
    type: modbus_tcp
    description: "Modbus TCP connection to pump controllers"
    connection_string: "TCP:10.0.2.50:502"
    unit_id: 1
    enabled: false
    polling_interval: 1
    registers:
      - {address: 100, type: "holding", count: 2, node_id: "pump_station_01", unit: "RPM", scale: 1.0}
      - {address: 102, type: "holding", count: 2, node_id: "pump_station_01_flow", unit: "m3/h", scale: 0.1}
      - {address: 200, type: "input", count: 1, node_id: "pump_station_01_pressure", unit: "bar", scale: 0.01}

# Tag naming convention:
#   {sector}_{asset}_{location}_{measurement}
#   Example: water_pump_carlisle_flow
#            power_substation_north_frequency
#            telecom_tower_central_uptime

# Data quality settings:
quality:
  missingness_threshold: 0.10   # >10% missing = degraded
  stuck_at_cv_threshold: 0.01   # CV < 0.01 = stuck sensor
  drift_multiplier: 2.0         # Mean shift > 2Ïƒ = drift
  min_samples: 10               # Minimum samples for analysis
